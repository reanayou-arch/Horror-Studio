<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Horror-Studio ‚Äî –ê–≤—Ç–æ—Ä</title>

<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: #111;
    color: white;
    padding: 15px;
  }

  h1 {
    text-align: center;
    font-size: 22px;
    margin-bottom: 15px;
  }

  .block {
    background: rgba(255,255,255,0.06);
    padding: 14px;
    border-radius: 14px;
    margin-bottom: 15px;
  }

  input, textarea {
    width: 100%;
    padding: 10px;
    border-radius: 12px;
    border: none;
    margin-top: 6px;
    background: rgba(255,255,255,0.12);
    color: white;
    font-size: 14px;
  }

  textarea { min-height: 70px; }

  .avatar-preview {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    margin-top: 10px;
    object-fit: cover;
    display: none;
  }

  button {
    width: 100%;
    padding: 14px;
    border-radius: 14px;
    border: none;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
  }

  .add {
    background: rgba(255,255,255,0.15);
    color: white;
    margin-top: 10px;
  }

  .save {
    background: darkred;
    color: white;
    margin-top: 15px;
  }

  .char-card {
    margin-top: 12px;
    padding: 12px;
    border-radius: 14px;
    background: rgba(255,255,255,0.05);
  }
</style>
</head>

<body>

<h1>–°–æ–∑–¥–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏</h1>

<div class="block">
  <label>–ê–≤–∞—Ç–∞—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏:</label>
  <input type="file" id="storyAvatarInput" accept="image/*">
  <img id="storyAvatarPreview" class="avatar-preview">
</div>

<div class="block">
  <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
  <input id="title">
  <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
  <textarea id="description"></textarea>
</div>

<div class="block">
  <label>–ü—Ä–æ—à–ª–æ–µ:</label>
  <textarea id="past"></textarea>
  <label>–ù–∞—á–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:</label>
  <textarea id="start"></textarea>
</div>

<div class="block">
  <h3>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
  <div id="charList"></div>
  <button class="add" onclick="addChar()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
</div>

<button class="save" onclick="saveStory()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>

<script>
let characters = [];
let storyAvatar = "";

document.getElementById("storyAvatarInput").addEventListener("change", e=>{
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = ev=>{
    storyAvatar = ev.target.result;
    const img = document.getElementById("storyAvatarPreview");
    img.src = storyAvatar;
    img.style.display="block";
  };
  reader.readAsDataURL(file);
});

function addChar(){
  characters.push({name:"", personality:"", avatar:""});
  renderChars();
}

function renderChars(){
  const list=document.getElementById("charList");
  list.innerHTML="";
  characters.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="char-card";
    div.innerHTML=`
      <label>–ò–º—è:</label>
      <input value="${c.name}" oninput="characters[${i}].name=this.value">
      <label>–•–∞—Ä–∞–∫—Ç–µ—Ä:</label>
      <textarea oninput="characters[${i}].personality=this.value">${c.personality}</textarea>
      <label>–ê–≤–∞—Ç–∞—Ä–∫–∞:</label>
      <input type="file" accept="image/*" onchange="loadAvatar(event,${i})">
    `;
    list.appendChild(div);
  });
}

function loadAvatar(e,i){
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=ev=>{
    characters[i].avatar=ev.target.result;
  };
  reader.readAsDataURL(file);
}

function saveStory(){
  let stories=JSON.parse(localStorage.getItem("stories")||"[]");

  const story={
    avatar: storyAvatar,
    title: document.getElementById("title").value,
    description: document.getElementById("description").value,
    setup:{
      past: document.getElementById("past").value,
      startSituation: document.getElementById("start").value
    },
    characters
  };

  stories.push(story);
  localStorage.setItem("stories",JSON.stringify(stories));
  alert("–ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!");
  location.href="index.html";
}
</script>

</body>
</html>
